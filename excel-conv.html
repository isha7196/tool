<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free online Excel file converter - Convert XLS, XLSX to CSV, PDF, Word while preserving formatting and formulas. Select specific sheets or ranges for conversion.">
    <meta name="keywords" content="Excel converter, XLS to CSV, XLSX to PDF, Excel to Word, spreadsheet converter">
    <title>Excel File Converter | Convert XLS/XLSX to CSV, PDF, Word Online</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --light-bg: #f8f9fa;
            --dark-text: #212529;
            --light-text: #6c757d;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: #f5f7ff;
            color: var(--dark-text);
            line-height: 1.6;
        }
        
        .converter-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border-radius: 12px;
            background: white;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .ad-container {
            margin: 1.5rem 0;
            padding: 1rem;
            background: var(--light-bg);
            border-radius: 8px;
            text-align: center;
            min-height: 90px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .file-drop-area {
            border: 2px dashed #ced4da;
            border-radius: 10px;
            padding: 2.5rem;
            text-align: center;
            margin: 1.5rem 0;
            transition: all 0.3s ease;
            background-color: rgba(67, 97, 238, 0.03);
        }
        
        .file-drop-area.active {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.08);
            transform: translateY(-2px);
        }
        
        .sheet-selector {
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding: 0.5rem;
            border-radius: 8px;
            background-color: var(--light-bg);
        }
        
        .progress {
            height: 10px;
            margin: 1.5rem 0;
            border-radius: 5px;
        }
        
        .progress-bar {
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }
        
        .format-option {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 1.5rem 0.5rem;
            height: 100%;
        }
        
        .format-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .format-option.active {
            border-color: var(--primary-color) !important;
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .format-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .file-info-card {
            border-left: 4px solid var(--primary-color);
            border-radius: 8px;
        }
        
        .preview-area {
            border-radius: 8px;
            background-color: var(--light-bg);
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .tooltip-inner {
            max-width: 250px;
            padding: 0.5rem 1rem;
        }
        
        /* Responsive adjustments */
        @media (max-width: 992px) {
            .converter-container {
                padding: 1.5rem;
            }
            
            .format-option {
                padding: 1rem 0.5rem;
            }
        }
        
        @media (max-width: 768px) {
            .converter-container {
                margin: 1rem;
                padding: 1.25rem;
                border-radius: 10px;
            }
            
            .file-drop-area {
                padding: 1.5rem 1rem;
            }
            
            .format-icon {
                font-size: 2rem;
            }
            
            h1 {
                font-size: 1.75rem;
            }
            
            h5 {
                font-size: 1.25rem;
            }
        }
        
        @media (max-width: 576px) {
            .converter-container {
                margin: 0.5rem;
                padding: 1rem;
                box-shadow: none;
                border-radius: 0;
                border: none;
            }
            
            .file-drop-area {
                padding: 1.25rem 0.5rem;
            }
            
            .format-option {
                margin-bottom: 1rem;
            }
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade {
            animation: fadeIn 0.3s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-3 py-md-4">
        <div class="converter-container animate-fade">
            <div class="text-center mb-4">
                <h1 class="fw-bold mb-2">Excel File Converter</h1>
                <p class="lead text-muted mb-0">Convert your spreadsheets to any format in seconds</p>
                <div class="d-flex justify-content-center align-items-center mt-2">
                    <span class="badge bg-success me-2">Easy to use</span>
                    <span class="badge bg-primary">100% Free</span>
                </div>
            </div>
            
            <!-- Top Ad Unit -->
            <div class="ad-container">
                <!-- Google AdSense Ad Unit -->
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID" crossorigin="anonymous"></script>
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
                     data-ad-slot="YOUR_AD_SLOT_ID"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            
            <div class="row g-4">
                <!-- Left Column - File Input & Options -->
                <div class="col-lg-6">
                    <div class="file-drop-area" id="dropArea">
                        <div class="py-3">
                            <i class="bi bi-file-earmark-excel format-icon text-primary"></i>
                            <h5 class="mt-2 mb-3">Upload Your Excel File</h5>
                            <p class="text-muted mb-3">Drag & drop your file here or</p>
                            <input type="file" id="fileInput" class="d-none" accept=".xls,.xlsx">
                            <button class="btn btn-primary px-4" onclick="document.getElementById('fileInput').click()">
                                <i class="bi bi-upload me-2"></i>Browse Files
                            </button>
                            <p class="small text-muted mt-3 mb-0">Supports .xls and .xlsx formats</p>
                        </div>
                    </div>
                    
                    <div id="fileInfo" class="d-none mb-3 animate-fade">
                        <div class="card file-info-card">
                            <div class="card-body py-2 d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-file-earmark-excel text-primary fs-4 me-3"></i>
                                    <div>
                                        <h6 class="mb-0" id="fileName"></h6>
                                        <small class="text-muted" id="fileSize"></small>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-danger" onclick="resetConverter()" data-bs-toggle="tooltip" title="Remove file">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="sheetSelection" class="d-none animate-fade">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="mb-0">Select Sheets</h5>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="selectAllSheets" role="switch">
                                <label class="form-check-label small" for="selectAllSheets">Select All</label>
                            </div>
                        </div>
                        <div class="sheet-selector">
                            <div id="sheetList" class="row row-cols-1 row-cols-md-2 g-2"></div>
                        </div>
                    </div>
                    
                    <div id="rangeSelection" class="d-none mt-4 animate-fade">
                        <h5 class="mb-3">Custom Range <small class="text-muted">(Optional)</small></h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="startCell" class="form-label small fw-bold">From Cell</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-arrow-right"></i></span>
                                    <input type="text" class="form-control" id="startCell" placeholder="A1">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="endCell" class="form-label small fw-bold">To Cell</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-arrow-left"></i></span>
                                    <input type="text" class="form-control" id="endCell" placeholder="D20">
                                </div>
                            </div>
                        </div>
                        <div class="form-text">Leave blank to convert entire sheet</div>
                    </div>
                </div>
                
                <!-- Right Column - Format Selection -->
                <div class="col-lg-6">
                    <h5 class="mb-3">Output Format</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="card format-option h-100" data-format="csv" onclick="selectFormat(this)">
                                <div class="card-body text-center">
                                    <i class="bi bi-file-earmark-text format-icon text-success"></i>
                                    <h6 class="mt-1 mb-2">CSV</h6>
                                    <small class="text-muted d-block">Comma Separated Values</small>
                                    <span class="badge bg-success bg-opacity-10 text-success small mt-2">Best for data</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card format-option h-100" data-format="pdf" onclick="selectFormat(this)">
                                <div class="card-body text-center">
                                    <i class="bi bi-file-earmark-pdf format-icon text-danger"></i>
                                    <h6 class="mt-1 mb-2">PDF</h6>
                                    <small class="text-muted d-block">Portable Document</small>
                                    <span class="badge bg-danger bg-opacity-10 text-danger small mt-2">Best for printing</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card format-option h-100" data-format="word" onclick="selectFormat(this)">
                                <div class="card-body text-center">
                                    <i class="bi bi-file-earmark-word format-icon text-primary"></i>
                                    <h6 class="mt-1 mb-2">Word</h6>
                                    <small class="text-muted d-block">Microsoft Word</small>
                                    <span class="badge bg-primary bg-opacity-10 text-primary small mt-2">Best for reports</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="formatOptions" class="d-none animate-fade">
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="card-title mb-3">
                                    <i class="bi bi-gear me-2"></i>Conversion Options
                                </h6>
                                
                                <div id="csvOptions" class="format-options">
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" id="preserveFormulasCSV">
                                        <label class="form-check-label" for="preserveFormulasCSV">Preserve formulas (as text)</label>
                                    </div>
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" id="includeHeadersCSV" checked>
                                        <label class="form-check-label" for="includeHeadersCSV">Include headers</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="utf8EncodingCSV" checked>
                                        <label class="form-check-label" for="utf8EncodingCSV">UTF-8 encoding</label>
                                    </div>
                                </div>
                                
                                <div id="pdfOptions" class="format-options">
                                    <div class="mb-3">
                                        <label for="pdfOrientation" class="form-label small fw-bold">Page Orientation</label>
                                        <select class="form-select" id="pdfOrientation">
                                            <option value="portrait">Portrait</option>
                                            <option value="landscape">Landscape</option>
                                        </select>
                                    </div>
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" id="preserveFormattingPDF" checked>
                                        <label class="form-check-label" for="preserveFormattingPDF">Preserve formatting</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="fitToPagePDF" checked>
                                        <label class="form-check-label" for="fitToPagePDF">Fit to page width</label>
                                    </div>
                                </div>
                                
                                <div id="wordOptions" class="format-options">
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" id="preserveFormattingWord" checked>
                                        <label class="form-check-label" for="preserveFormattingWord">Preserve formatting</label>
                                    </div>
                                    <div class="form-check form-switch mb-2">
                                        <input class="form-check-input" type="checkbox" id="includeImagesWord" checked>
                                        <label class="form-check-label" for="includeImagesWord">Include images</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="createTableWord" checked>
                                        <label class="form-check-label" for="createTableWord">Create Word table</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button id="convertBtn" class="btn btn-primary w-100 py-3 fw-bold" onclick="convertFile()">
                            <span id="convertText">
                                <i class="bi bi-lightning-charge-fill me-2"></i>Convert Now
                            </span>
                            <span id="convertSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                        </button>
                        
                        <div class="d-flex justify-content-between small text-muted mt-2">
                            <span>Conversion progress:</span>
                            <span id="progressText">0%</span>
                        </div>
                        <div class="progress d-none" id="progressBar">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Middle Ad Unit -->
            <div class="ad-container mt-4">
                <!-- Google AdSense Ad Unit -->
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID" crossorigin="anonymous"></script>
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
                     data-ad-slot="YOUR_AD_SLOT_ID_2"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            
            <div id="resultSection" class="d-none mt-4 animate-fade">
                <div class="card border-success">
                    <div class="card-header bg-success bg-opacity-10 text-success d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-check-circle-fill me-2"></i>Conversion Complete
                        </h5>
                        <button class="btn btn-sm btn-outline-success" onclick="resetResultSection()">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success d-flex align-items-center">
                            <i class="bi bi-info-circle-fill me-3 fs-4"></i>
                            <div>
                                <span id="resultMessage"></span>
                                <div id="downloadButtons" class="mt-2 d-flex flex-wrap gap-2"></div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <h6 class="d-flex align-items-center">
                                <i class="bi bi-eye-fill me-2"></i>Preview
                                <small class="text-muted ms-2">(First 100 rows shown)</small>
                            </h6>
                            <div id="previewArea" class="preview-area p-3 mt-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="mt-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start">
                        <p class="mb-0">Â© 2023 Excel File Converter Tool. All rights reserved.</p>
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <p class="mb-0">
                            <a href="/privacy" class="text-decoration-none me-2">Privacy Policy</a>
                            <a href="/terms" class="text-decoration-none me-2">Terms of Service</a>
                            <a href="/contact" class="text-decoration-none">Contact Us</a>
                        </p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Global variables
        let workbook = null;
        let selectedFormat = null;
        let convertedData = null;
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop();
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            document.getElementById('selectAllSheets').addEventListener('change', toggleAllSheets);
            
            // Initialize tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
        
        // Set up drag and drop functionality
        function setupDragAndDrop() {
            const dropArea = document.getElementById('dropArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            dropArea.addEventListener('drop', handleDrop, false);
        }
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        function highlight() {
            document.getElementById('dropArea').classList.add('active');
        }
        
        function unhighlight() {
            document.getElementById('dropArea').classList.remove('active');
        }
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0 && (files[0].name.endsWith('.xls') || files[0].name.endsWith('.xlsx'))) {
                handleFileSelect({ target: { files: files } });
            } else {
                showToast('Please upload a valid Excel file (.xls or .xlsx)', 'danger');
            }
        }
        
        // Handle file selection
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showToast('File size exceeds 10MB limit', 'danger');
                return;
            }
            
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('fileInfo').classList.remove('d-none');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                processExcel(data);
            };
            reader.onerror = function() {
                showToast('Error reading file', 'danger');
                resetConverter();
            };
            reader.readAsArrayBuffer(file);
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Process the Excel file
        function processExcel(data) {
            try {
                showToast('Processing Excel file...', 'info');
                workbook = XLSX.read(data, { type: 'array' });
                displaySheetList(workbook);
                document.getElementById('sheetSelection').classList.remove('d-none');
                document.getElementById('rangeSelection').classList.remove('d-none');
                showToast('File loaded successfully', 'success');
            } catch (error) {
                showToast('Error reading Excel file: ' + error.message, 'danger');
                resetConverter();
            }
        }
        
        // Display the list of sheets
        function displaySheetList(workbook) {
            const sheetList = document.getElementById('sheetList');
            sheetList.innerHTML = '';
            
            workbook.SheetNames.forEach((sheetName, index) => {
                const col = document.createElement('div');
                col.className = 'col';
                
                const div = document.createElement('div');
                div.className = 'form-check p-2 border rounded';
                
                const input = document.createElement('input');
                input.className = 'form-check-input sheet-checkbox';
                input.type = 'checkbox';
                input.id = `sheet-${index}`;
                input.value = sheetName;
                input.checked = true;
                
                const label = document.createElement('label');
                label.className = 'form-check-label';
                label.htmlFor = `sheet-${index}`;
                label.textContent = sheetName;
                
                div.appendChild(input);
                div.appendChild(label);
                col.appendChild(div);
                sheetList.appendChild(col);
            });
        }
        
        // Toggle all sheets selection
        function toggleAllSheets() {
            const checkboxes = document.querySelectorAll('.sheet-checkbox');
            const selectAll = document.getElementById('selectAllSheets').checked;
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll;
            });
        }
        
        // Select output format
        function selectFormat(element) {
            // Remove active class from all format options
            document.querySelectorAll('.format-option').forEach(opt => {
                opt.classList.remove('active');
            });
            
            // Add active class to selected option
            element.classList.add('active');
            
            // Set selected format
            selectedFormat = element.getAttribute('data-format');
            
            // Hide all format options
            document.querySelectorAll('.format-options').forEach(opt => {
                opt.style.display = 'none';
            });
            
            // Show options for selected format
            document.getElementById(`${selectedFormat}Options`).style.display = 'block';
            
            // Show convert button
            document.getElementById('formatOptions').classList.remove('d-none');
            
            // Scroll to options if on mobile
            if (window.innerWidth < 768) {
                document.getElementById('formatOptions').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        // Convert the file
        function convertFile() {
            if (!selectedFormat) {
                showToast('Please select an output format', 'warning');
                return;
            }
            
            const sheets = getSelectedSheets();
            if (sheets.length === 0) {
                showToast('Please select at least one sheet to convert', 'warning');
                return;
            }
            
            const startCell = document.getElementById('startCell').value.trim();
            const endCell = document.getElementById('endCell').value.trim();
            const range = (startCell || endCell) ? { s: startCell, e: endCell } : null;
            
            // Show loading state
            document.getElementById('convertText').classList.add('d-none');
            document.getElementById('convertSpinner').classList.remove('d-none');
            document.getElementById('convertBtn').disabled = true;
            document.getElementById('progressBar').classList.remove('d-none');
            
            // Simulate progress (in a real app, this would be actual conversion progress)
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 2;
                if (progress > 100) progress = 100;
                
                document.querySelector('.progress-bar').style.width = `${progress}%`;
                document.getElementById('progressText').textContent = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    finishConversion(sheets, range);
                }
            }, 50);
        }
        
        // Get selected sheets
        function getSelectedSheets() {
            const checkboxes = document.querySelectorAll('.sheet-checkbox:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }
        
        // Finish conversion and show results
        function finishConversion(sheets, range) {
            try {
                // Perform conversion based on selected format
                switch (selectedFormat) {
                    case 'csv':
                        convertedData = convertToCSV(sheets, range);
                        break;
                    case 'pdf':
                        convertedData = convertToPDF(sheets, range);
                        break;
                    case 'word':
                        convertedData = convertToWord(sheets, range);
                        break;
                }
                
                // Display results
                displayResults();
                showToast('Conversion completed successfully', 'success');
            } catch (error) {
                showToast('Conversion error: ' + error.message, 'danger');
            } finally {
                // Reset button state
                document.getElementById('convertText').classList.remove('d-none');
                document.getElementById('convertSpinner').classList.add('d-none');
                document.getElementById('convertBtn').disabled = false;
            }
        }
        
        // Convert to CSV
        function convertToCSV(sheets, range) {
            const options = {
                FS: ",",
                RS: "\n",
                includeHeaders: document.getElementById('includeHeadersCSV').checked,
                preserveFormulas: document.getElementById('preserveFormulasCSV').checked,
                range: range
            };
            
            let csvData = {};
            
            sheets.forEach(sheetName => {
                const worksheet = workbook.Sheets[sheetName];
                csvData[sheetName] = XLSX.utils.sheet_to_csv(worksheet, options);
            });
            
            return csvData;
        }
        
        // Convert to PDF
        function convertToPDF(sheets, range) {
            const orientation = document.getElementById('pdfOrientation').value;
            const preserveFormatting = document.getElementById('preserveFormattingPDF').checked;
            
            // In a real implementation, you would use a library like pdfmake or jsPDF
            // This is a simplified version for demonstration
            
            let pdfData = {
                orientation: orientation,
                sheets: {}
            };
            
            sheets.forEach(sheetName => {
                const worksheet = workbook.Sheets[sheetName];
                const html = XLSX.utils.sheet_to_html(worksheet, { range: range });
                pdfData.sheets[sheetName] = html;
            });
            
            return pdfData;
        }
        
        // Convert to Word
        function convertToWord(sheets, range) {
            const preserveFormatting = document.getElementById('preserveFormattingWord').checked;
            const includeImages = document.getElementById('includeImagesWord').checked;
            
            // In a real implementation, you would use a library like docx or mammoth
            // This is a simplified version for demonstration
            
            let wordData = {
                sheets: {}
            };
            
            sheets.forEach(sheetName => {
                const worksheet = workbook.Sheets[sheetName];
                const html = XLSX.utils.sheet_to_html(worksheet, { range: range });
                wordData.sheets[sheetName] = html;
            });
            
            return wordData;
        }
        
        // Display conversion results
        function displayResults() {
            const resultSection = document.getElementById('resultSection');
            const resultMessage = document.getElementById('resultMessage');
            const downloadButtons = document.getElementById('downloadButtons');
            const previewArea = document.getElementById('previewArea');
            
            resultSection.classList.remove('d-none');
            downloadButtons.innerHTML = '';
            
            // Set result message
            resultMessage.textContent = `Your Excel file has been converted to ${selectedFormat.toUpperCase()} format.`;
            
            // Create download buttons
            if (selectedFormat === 'csv') {
                for (const [sheetName, csvContent] of Object.entries(convertedData)) {
                    const button = document.createElement('button');
                    button.className = 'btn btn-success btn-sm';
                    button.innerHTML = `<i class="bi bi-download me-1"></i> ${sheetName}.csv`;
                    button.onclick = () => downloadCSV(csvContent, sheetName);
                    downloadButtons.appendChild(button);
                }
                
                // Show preview of first sheet
                const firstSheet = Object.keys(convertedData)[0];
                previewArea.innerHTML = `<pre class="m-0">${convertedData[firstSheet].split('\n').slice(0, 100).join('\n')}</pre>`;
            } else {
                const button = document.createElement('button');
                button.className = 'btn btn-success';
                button.innerHTML = `<i class="bi bi-download me-1"></i> Download All as ${selectedFormat.toUpperCase()}`;
                button.onclick = () => downloadCombined();
                downloadButtons.appendChild(button);
                
                // Show preview for PDF/Word
                previewArea.innerHTML = `
                    <div class="d-flex flex-column align-items-center justify-content-center h-100">
                        <i class="bi bi-file-earmark-${selectedFormat} fs-1 text-muted mb-2"></i>
                        <p class="text-muted text-center">Preview not available for ${selectedFormat.toUpperCase()} format.<br>Download the file to view the converted document.</p>
                    </div>
                `;
            }
            
            // Scroll to results
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // Download CSV file
        function downloadCSV(content, sheetName) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            saveAs(blob, `${sheetName}.csv`);
            showToast(`Downloading ${sheetName}.csv`, 'success');
        }
        
        // Download combined file (for PDF/Word)
        function downloadCombined() {
            // In a real implementation, this would create and download the actual file
            showToast(`Preparing ${selectedFormat.toUpperCase()} file for download`, 'info');
            
            // Simulate download delay
            setTimeout(() => {
                showToast(`Downloading combined ${selectedFormat.toUpperCase()} file`, 'success');
            }, 1500);
        }
        
        // Reset the converter
        function resetConverter() {
            workbook = null;
            selectedFormat = null;
            convertedData = null;
            
            document.getElementById('fileInfo').classList.add('d-none');
            document.getElementById('sheetSelection').classList.add('d-none');
            document.getElementById('rangeSelection').classList.add('d-none');
            document.getElementById('formatOptions').classList.add('d-none');
            document.getElementById('resultSection').classList.add('d-none');
            document.getElementById('fileInput').value = '';
            
            // Reset format selection
            document.querySelectorAll('.format-option').forEach(opt => {
                opt.classList.remove('active');
            });
            
            // Reset progress bar
            document.getElementById('progressBar').classList.add('d-none');
            document.querySelector('.progress-bar').style.width = '0%';
            document.getElementById('progressText').textContent = '0%';
        }
        
        // Reset just the result section
        function resetResultSection() {
            document.getElementById('resultSection').classList.add('d-none');
        }
        
        // Show toast notification
        function showToast(message, type) {
            // In a real implementation, you would use a proper toast library
            console.log(`${type.toUpperCase()}: ${message}`);
        }
    </script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
